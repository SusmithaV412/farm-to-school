<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chats - Farm2School</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: url('https://img.freepik.com/free-vector/watercolor-emerald-background_23-2150270303.jpg'); background-size: cover; background-position: center; background-attachment: fixed; }
        .chat-list-container { max-width: 800px; margin: 100px auto 20px; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .chat-header { background: #2c8a2e; color: white; padding: 20px; border-radius: 10px 10px 0 0; }
        .chat-item { padding: 15px 20px; border-bottom: 1px solid #eee; cursor: pointer; transition: background 0.2s; }
        .chat-item:hover { background: #f5f5f5; }
        .chat-item:last-child { border-bottom: none; }
        .chat-info { display: flex; justify-content: space-between; align-items: center; }
        .chat-details h3 { margin-bottom: 5px; color: #333; }
        .chat-details p { color: #666; font-size: 0.9rem; }
        .chat-meta { text-align: right; }
        .chat-time { color: #999; font-size: 0.8rem; }
        .unread-count { background: #2c8a2e; color: white; border-radius: 50%; padding: 2px 6px; font-size: 0.7rem; margin-top: 5px; min-width: 18px; text-align: center; }
        .notification-badge { position: fixed; top: 20px; right: 20px; background: #dc3545; color: white; padding: 10px 15px; border-radius: 20px; z-index: 1000; animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
        .back-btn { position: absolute; top: 20px; left: 20px; background: #2c8a2e; color: white; padding: 10px 15px; border-radius: 20px; text-decoration: none; }
        .no-chats { text-align: center; padding: 50px; color: #666; }
    </style>
</head>
<body>
    {% if user_type == 'farmer' %}
        <a href="/farmer_dashboard" class="back-btn"><i class="fas fa-arrow-left"></i> Back</a>
    {% else %}
        <a href="/school_dashboard" class="back-btn"><i class="fas fa-arrow-left"></i> Back</a>
    {% endif %}
    
    <div class="chat-list-container">
        <div class="chat-header">
            <h2><i class="fas fa-comments"></i> Chats</h2>
            <p>Your conversations</p>
        </div>
        
        <div class="chat-list">
            {% if conversations %}
                {% for conv in conversations %}
                <div class="chat-item" onclick="openChat('{{ conv.other_user_id }}')">
                    <div class="chat-info">
                        <div class="chat-details">
                            <h3>{{ conv.other_user_name }}</h3>
                            <p>{{ conv.last_message[:50] }}{{ '...' if conv.last_message|length > 50 else '' }}</p>
                        </div>
                        <div class="chat-meta">
                            <div class="chat-time">{{ conv.last_message_time.strftime('%m/%d') if conv.last_message_time else '' }}</div>
                            {% if conv.unread_count > 0 %}
                                <div class="unread-count">{{ conv.unread_count }}</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="no-chats">
                    <i class="fas fa-comments" style="font-size: 3rem; margin-bottom: 15px;"></i>
                    <h3>No conversations yet</h3>
                    <p>Start chatting with {{ 'schools' if user_type == 'farmer' else 'farmers' }} from your dashboard</p>
                </div>
            {% endif %}
        </div>
    </div>
    
    <script>
        function openChat(userId) {
            window.location.href = '/chat/' + userId;
        }
    </script>
</body>
</html>